(()=>{"use strict";const e=class{constructor(e){this.containerEle=e,this.formEle=this.containerEle.querySelector("form"),this.submitBttn=this.formEle.querySelector("button"),this.validationEle=this.containerEle.querySelector(".validation"),this.stepFormEle=this.containerEle.querySelector(".shipping-step-form"),this.stepStatusEle=this.containerEle.querySelector(".shipping-step-status"),this.abortController=new AbortController,this.getOrderNumberQueryParam(),this.handleFormSubmit(),""!==this.orderNR&&null!==this.orderNR&&this.fetchOrderData()}handleFormSubmit(){this.formEle.addEventListener("submit",(e=>{if(e.preventDefault(),this.orderNR=this.formEle.querySelector("input[name=order-number]").value,history.pushState){const e=window.location.protocol+"//"+window.location.host+window.location.pathname+"?order-number="+this.orderNR;window.history.pushState({path:e},"",e)}this.fetchOrderData()}))}getOrderNumberQueryParam(){const e=new URLSearchParams(window.location.search).get("order-number");return this.orderNR=e,e}fetchOrderData(){this.fetchRunning?(this.abortController.abort(),this.abortController=new AbortController):this.fetchRunning=!0,this.submitBttn.disabled=!0,this.validationEle.classList.add("hidden");const e=uafrica_shipping_l10n.v3_api_url.replace("NUMBER",this.orderNR).replace("DOMAIN",uafrica_shipping_l10n.domain);fetch(e,{signal:this.abortController.signal}).then((e=>e.json())).then((e=>{void 0===e[0]?this.displayError():(this.shipping_details=e[0],this.displayOrderData())})).catch((e=>{20!==e.code&&(console.log(e),this.displayError())})).finally((()=>{this.fetchRunning=!1,this.submitBttn.disabled=!1}))}displayOrderData(){if(this.stepFormEle.classList.add("hidden"),this.stepStatusEle.classList.remove("hidden"),this._setValue(this.stepStatusEle,"status",this.shipping_details.status_friendly),this._setValue(this.stepStatusEle,"custom_order_name",this.shipping_details.custom_order_name),this._setValue(this.stepStatusEle,"courier_name",this.shipping_details.courier_name),this._setValue(this.stepStatusEle,"courier_phone",this.shipping_details.courier_phone),this._setValue(this.stepStatusEle,"id",this.shipping_details.id),this.shipping_details.show_branding||(document.getElementById("show_branding").style.display="none"),"pending-collection"===this.shipping_details.status)document.getElementById("table_checkpoints").style.display="none",this._setValue(this.stepStatusEle,"delivery_heading","Tracking details"),this._setValue(this.stepStatusEle,"delivery_message","Your shipment will be collected soon. Please check back later for more information.");else if("cancelled-by-courier"===this.shipping_details.status)this._setValue(this.stepStatusEle,"delivery_heading","Tracking details"),this._setValue(this.stepStatusEle,"delivery_message","The shipment has been cancelled."),document.getElementById("table_checkpoints").style.display="none";else if("cancelled"===this.shipping_details.status)this._setValue(this.stepStatusEle,"delivery_heading","Tracking details"),this._setValue(this.stepStatusEle,"delivery_message","The shipment has been cancelled."),document.getElementById("table_checkpoints").style.display="none";else{if(this.shipping_details.checkpoints.length<=0)return document.getElementById("table_checkpoints").style.display="none",this._setValue(this.stepStatusEle,"delivery_heading","Tracking details"),void this._setValue(this.stepStatusEle,"delivery_message","Tracking information is not yet available. Please check back later for more information.");let e=new Date(this.shipping_details.checkpoints[0].time),t=e.toLocaleString("default",{weekday:"long"})+", "+e.getDate()+" "+e.toLocaleString("default",{month:"short"})+" "+e.getFullYear();this._setValue(this.stepStatusEle,"time",t),document.getElementById("table_else").style.display="none",this.shipping_details.checkpoints.forEach((function(e){let t=document.getElementById("delivery_steps").appendChild(document.createElement("tr")),s=document.createElement("td"),i=new Date(e.time);s.style.width="25%";let n=i.getHours()<10?"0"+i.getHours():i.getHours(),l=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes();s.innerHTML=i.getFullYear()+" "+i.toLocaleString("default",{month:"short"})+" "+i.getDate()+", "+n+":"+l;let a=document.createElement("td");a.innerHTML=e.status_friendly,a.style.fontWeight="bold",a.style.width="25%";let r=document.createElement("td");r.innerHTML=e.message,t.appendChild(s),t.appendChild(a),t.appendChild(r)}))}this.stepStatusEle.querySelector("[data-uafrica=checkpoints-template] .step"),this.stepStatusEle.querySelector(".checkpoints")}displayError(){this.validationEle.classList.remove("hidden"),this.validationEle.textContent=uafrica_shipping_l10n.not_found.replace("%s",this.orderNR)}_setValue(e,t,s){const i=e.querySelectorAll("[data-uafrica="+t+"]");0!==i.length&&i.forEach((function(e){e.textContent=s}))}};document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelectorAll(".uafrica-shipping-container");if(null===t)return;t.forEach((function(t){new e(t)}));const s=document.querySelectorAll(".order-nr-input");null!==s&&s.length>0&&s[0].focus()}))})();